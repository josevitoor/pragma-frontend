<tce-container>
  <tce-container-header
    title="Gerador Automatizado de Código CRUD"
    [showBtn]="false"
  ></tce-container-header>

  <main class="mt-3">
    <mat-horizontal-stepper [linear]="true" #stepper>
      <!-- Step para Conexão com Banco de Dados -->
      <mat-step
        [stepControl]="connectionForm"
        [completed]="connectionCompleted"
      >
        <form [formGroup]="connectionForm">
          <ng-template matStepLabel>Conexão Banco de Dados</ng-template>
          <fieldset>
            <small class="right-form">(*) Campos Obrigatórios</small>
            <legend>Formulário Conexão Banco de Dados</legend>
            <div class="form-row">
              <div class="col-4">
                <tce-input-field
                  label="Servidor"
                  formControlName="servidor"
                  type="text"
                  placeholder="Digite o servidor de conexão"
                  [control]="connectionForm.get('servidor')"
                >
                </tce-input-field>
              </div>
              <div class="col-4">
                <tce-input-field
                  label="Porta"
                  formControlName="porta"
                  type="text"
                  placeholder="Digite a porta de conexão"
                  [control]="connectionForm.get('porta')"
                >
                </tce-input-field>
              </div>
              <div class="col-4">
                <tce-input-field
                  label="Usuário"
                  formControlName="usuario"
                  type="text"
                  placeholder="Digite o usuário de conexão"
                  [control]="connectionForm.get('usuario')"
                >
                </tce-input-field>
              </div>
            </div>
            <div class="form-row">
              <div class="col-4">
                <tce-input-field
                  label="Senha"
                  formControlName="senha"
                  type="password"
                  placeholder="Digite a senha de conexão"
                  [control]="connectionForm.get('senha')"
                >
                </tce-input-field>
              </div>
              <div class="col-4">
                <tce-input-field
                  label="Banco de Dados"
                  formControlName="baseDados"
                  type="text"
                  placeholder="Digite o banco de dados da conexão"
                  [control]="connectionForm.get('baseDados')"
                >
                </tce-input-field>
              </div>
            </div>
          </fieldset>
          <div class="mt-3 d-flex justify-content-between flex-wrap">
            <button
              class="btn btn-primary mb-2 w-sm-auto"
              (click)="openModalConfiguracaoConexaoBanco()"
            >
              SELECIONAR CONEXÃO
            </button>

            <button
              class="btn btn-primary mb-2 w-sm-auto"
              (click)="submitConnectionForm(stepper)"
            >
              TESTAR CONEXÃO E AVANÇAR
            </button>
          </div>
        </form>
      </mat-step>

      <!-- Step para Caminho da Geração de Código -->
      <mat-step [stepControl]="pathForm" [completed]="pathCompleted">
        <form [formGroup]="pathForm">
          <ng-template matStepLabel>Caminho para Gerar Arquivos</ng-template>
          <fieldset>
            <legend>Formulário do Caminho para Gerar Arquivos</legend>
            <div class="form-row">
              <div class="col-6">
                <tce-input-field
                  label="Caminho de Destino API"
                  formControlName="projectApiPath"
                  type="text"
                  placeholder="C:\Workspace\Project"
                  [control]="pathForm.get('projectApiPath')"
                ></tce-input-field>
              </div>
              <div class="col-6">
                <tce-input-field
                  label="Caminho de Destino Client"
                  formControlName="projectClientPath"
                  type="text"
                  placeholder="C:\Workspace\Project"
                  [control]="pathForm.get('projectClientPath')"
                ></tce-input-field>
              </div>
            </div>
            <div class="form-row">
              <div class="col-8">
                <tce-input-field
                  label="Caminho do Arquivo de Rotas"
                  formControlName="routerPath"
                  type="text"
                  placeholder="C:\Workspace\Project\src\app\router.ts"
                  [control]="pathForm.get('routerPath')"
                ></tce-input-field>
              </div>
            </div>
          </fieldset>
          <div class="mt-3 d-flex justify-content-between flex-wrap">
            <div class="d-flex flex-wrap gap-2">
              <button
                class="btn btn-outline-success w-auto mb-2 mb-sm-0"
                (click)="stepper.previous()"
              >
                VOLTAR
              </button>
              <button
                class="btn btn-primary w-auto mb-2 mb-sm-0 ml-3"
                (click)="openModalConfiguracaoCaminho()"
              >
                SELECIONAR CAMINHO
              </button>
            </div>
            <button
              class="btn btn-primary w-auto mb-2 mb-sm-0"
              (click)="submitPathForm(stepper)"
            >
              VALIDAR CAMINHO E AVANÇAR
            </button>
          </div>
        </form>
      </mat-step>

      <!-- Step para Informaçõe de Geração de Código -->
      <mat-step [stepControl]="resourceForm">
        <form [formGroup]="resourceForm">
          <ng-template matStepLabel>Configurar Geraração de Código</ng-template>
          <fieldset>
            <small class="right-form">(*) Campos Obrigatórios</small>
            <legend>Formulário Gerador de Código</legend>
            <div class="form-row mt-2">
              <div class="col-3">
                <tce-select-field
                  label="Nome da Tabela"
                  [itemFillSelect]="tableNameList"
                  formControlName="tableName"
                  bindLabelSelect="value"
                  bindValueSelect="value"
                  placeholder="Selecione uma tabela"
                  [control]="resourceForm.get('tableName')"
                >
                </tce-select-field>
              </div>
              <div class="col-3">
                <label for="entityName">Nome da Entidade</label>
                <svg
                  tooltip="Nome utilizado na geração de código para criar classes e componentes (Entity, Controller, Service, Type e Components)"
                  class="ml-1"
                  placement="right"
                  style="cursor: pointer"
                  width="10px"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 512 512"
                >
                  <
                  <path
                    d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"
                  />
                </svg>
                <tce-input-field
                  [showLabel]="false"
                  label="Nome da Entidade"
                  formControlName="entityName"
                  type="text"
                  placeholder="Digite o nome da entidade"
                  [control]="resourceForm.get('entityName')"
                >
                </tce-input-field>
              </div>
              <div class="col-3">
                <tce-select-field
                  label="Campos para Listagem"
                  [itemFillSelect]="tableColumnsFilterList"
                  formControlName="tableColumnsList"
                  bindLabelSelect="value"
                  bindValueSelect="value"
                  [deveSerMultiplo]="true"
                  placeholder="Selecione os campos que irão aparecer na tabela"
                  [control]="resourceForm.get('tableColumnsList')"
                >
                </tce-select-field>
              </div>
              <div class="col-3">
                <tce-select-field
                  label="Campos com Filtro"
                  [itemFillSelect]="tableColumnsFilterList"
                  formControlName="tableColumnsFilter"
                  bindLabelSelect="value"
                  bindValueSelect="value"
                  [deveSerMultiplo]="true"
                  placeholder="Selecione os campos da tabela com filtro habilitado"
                  [control]="resourceForm.get('tableColumnsFilter')"
                >
                </tce-select-field>
              </div>
            </div>
            <div class="form-row">
              <div class="col-3 mt-4">
                <mat-slide-toggle formControlName="hasTceBase">
                  PROJETO UTILIZA BIBLIOTECA TCE BASE
                </mat-slide-toggle>
              </div>
              <div class="col-3 mt-4">
                <mat-slide-toggle formControlName="isServerSide">
                  HABILITAR OPÇÕES LADO SERVIDOR
                </mat-slide-toggle>
              </div>
            </div>
            <div
              *ngIf="showTceBaseWarning"
              class="alert alert-warning mt-2"
              role="alert"
            >
              <strong>Atenção:</strong> Caso o projeto não utilize biblioteca
              TCE Base, que é o padrão atual, pode ser necessário ajustar alguns
              imports de infraestrutura nos serviços gerados, pois eles são
              específicos do projeto e não da biblioteca.
            </div>
            <div class="form-row mt-2">
              <div
                class="col-12"
                *ngIf="tableColumnsFormArray.controls.length > 0"
              >
                <table class="table table-bordered text-center w-100">
                  <thead class="thead-light">
                    <tr>
                      <th style="width: 40%">Campo da Tabela</th>
                      <th>Rótulo na Listagem</th>
                    </tr>
                  </thead>
                  <tbody formArrayName="tableColumnsFormArray">
                    <tr
                      *ngFor="
                        let column of tableColumnsFormArray.controls;
                        let i = index
                      "
                      [formGroupName]="i"
                    >
                      <td class="align-middle">
                        {{ column.get("databaseColumn")?.value }}
                      </td>
                      <td>
                        <input
                          type="text"
                          class="form-control"
                          formControlName="displayName"
                          placeholder="Digite o rótulo"
                        />
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </fieldset>

          <div class="mt-3 d-flex justify-content-between flex-wrap">
            <button
              class="btn btn-outline-success w-100 w-sm-auto mb-2 mb-sm-0"
              (click)="stepper.previous()"
            >
              VOLTAR
            </button>
            <button
              class="btn btn-primary mr-2 w-100 w-sm-auto mb-2 mb-sm-0"
              (click)="submitGenerateInfoForm()"
            >
              GERAR ARQUIVOS
            </button>
          </div>
        </form>
      </mat-step>
    </mat-horizontal-stepper>
  </main>
</tce-container>
